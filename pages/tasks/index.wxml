<view class="page-container">
  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <view class="date-section">
    <picker mode="date" value="{{currentDate}}" bindchange="onDateChange">
      <view class="date-picker">
        <text class="date">{{formattedDate}}</text>
        <text class="date-arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'tasks' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="tasks">
      ä»Šæ—¥äº‹é¡¹
    </view>
    <view class="tab-item {{activeTab === 'timeline' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="timeline">
      æ—¶é—´çº¿
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨éƒ¨åˆ† -->
  <view class="tasks-container" wx:if="{{activeTab === 'tasks'}}">
    <!-- é‡è¦ä¸”ç´§æ€¥çš„ä»»åŠ¡ -->
    <view class="tasks-list">
      <view class="task-heading">
        <view class="heading-main">
          <text class="heading-text">âš ï¸ ä»Šæ—¥å¿…åšä¸‰ä»¶äº‹</text>
        </view>
        <view class="heading-sub">Important + Urgent</view>
      </view>
      
      <block wx:for="{{tasks}}" wx:key="id">
        <view class="task-item {{item.completed ? 'completed' : ''}}">
          <view class="task-checkbox" bindtap="toggleTask" data-id="{{item.id}}">
            <view class="checkbox {{item.completed ? 'checked' : ''}}">
              <text wx:if="{{item.completed}}" class="check-icon">âœ“</text>
            </view>
          </view>
          <view class="task-content" bindtap="editTask" data-id="{{item.id}}">
            <text class="task-text">{{item.content || 'ç‚¹å‡»æ·»åŠ ä»»åŠ¡'}}</text>
            <view class="task-meta" wx:if="{{item.time || item.goalId}}">
              <text class="task-time" wx:if="{{item.time}}">ğŸ• {{item.time}}</text>
              <text class="goal-tag" wx:if="{{item.goalId}}">
                <block wx:for="{{goals}}" wx:key="id" wx:for-item="section">
                  <block wx:for="{{section.items}}" wx:key="id" wx:for-item="goal">
                    <block wx:if="{{goal.id === item.goalId}}">
                      ğŸ¯ {{section.title}} - {{goal.content}}
                    </block>
                  </block>
                </block>
              </text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- ä¸é‡è¦ä¸ç´§æ€¥çš„äº‹ -->
    <view class="unimportant-list">
      <view class="task-heading">
        <view class="heading-main">
          <text class="heading-text">ğŸ˜´ ä»Šæ—¥å¯å»¶åçš„äº‹</text>
        </view>
        <view class="heading-sub">Not Important + Not Urgent</view>
      </view>
      
      <block wx:for="{{unimportantTasks}}" wx:key="id">
        <view class="task-item unimportant {{item.completed ? 'completed' : ''}}">
          <view class="task-checkbox" bindtap="toggleUnimportantTask" data-id="{{item.id}}">
            <view class="checkbox {{item.completed ? 'checked' : ''}}">
              <text wx:if="{{item.completed}}" class="check-icon">âœ“</text>
            </view>
          </view>
          <view class="task-content" bindtap="editUnimportantTask" data-id="{{item.id}}">
            <text class="task-text">{{item.content || 'ç‚¹å‡»æ·»åŠ ä¸ç´§æ€¥ä¸é‡è¦çš„äº‹'}}</text>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- æ—¶é—´çº¿éƒ¨åˆ† -->
  <view class="timeline-container" wx:if="{{activeTab === 'timeline'}}">
    <view class="add-event" bindtap="showTimeModal">
      <image class="add-icon" src="/assets/tabbar/add.png" mode="aspectFit"/>
      <text>æ·»åŠ æ–°äº‹é¡¹</text>
    </view>

    <view class="timeline">
      <block wx:for="{{timelineItems}}" wx:key="id">
        <view class="timeline-item {{item.completed ? 'completed' : ''}}">
          <view class="time-column">
            <text class="time">{{item.time}}</text>
          </view>
          <view class="content-column">
            <view class="content-main">
              <view class="event-icon" bindtap="toggleComplete" data-id="{{item.id}}">{{item.icon}}</view>
              <view class="event-content">
                <text class="event-text">{{item.content}}</text>
                <text class="event-type">{{item.typeName}}</text>
              </view>
            </view>
            <view class="delete-btn" catchtap="deleteTimelineItem" data-id="{{item.id}}">åˆ é™¤</view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- æ·»åŠ äº‹é¡¹æ¨¡æ€æ¡† -->
  <view class="modal" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="hideModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>æ·»åŠ æ–°äº‹é¡¹</text>
      </view>
      <view class="modal-body">
        <picker mode="time" value="{{newEvent.time}}" bindchange="onTimeChange">
          <view class="form-item">
            <text class="label">æ—¶é—´</text>
            <text class="value">{{newEvent.time}}</text>
          </view>
        </picker>
        
        <picker value="{{newEvent.typeIndex}}" range="{{eventTypes}}" range-key="name" bindchange="onTypeChange">
          <view class="form-item">
            <text class="label">ç±»å‹</text>
            <text class="value">{{eventTypes[newEvent.typeIndex].icon}} {{eventTypes[newEvent.typeIndex].name}}</text>
          </view>
        </picker>

        <view class="form-item">
          <text class="label">å†…å®¹</text>
          <input class="input" 
                 value="{{newEvent.content}}" 
                 bindinput="onContentInput" 
                 placeholder="è¾“å…¥äº‹é¡¹å†…å®¹"/>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn cancel" bindtap="hideModal">å–æ¶ˆ</button>
        <button class="btn confirm" bindtap="addEvent">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
