<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tiny Wins</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="theme-color" content="#38bdf8" />
</head>
<body>
<header style="padding:30px 20px 10px;text-align:center;">
  <h1 style="margin:0;font-size:32px;line-height:1.2;">ğŸŒ¤ï¸ Tiny Wins</h1>
  <p style="color:#5f9ea0;font-size:15px;margin:6px 0 0 0;">
    âœ¨ Let's celebrate the victories âœ¨
  </p>
</header>
:root{
  --bg:#e6f7fb; --card:#ffffff; --text:#083344; --muted:#5f9ea0;
  --accent:#38bdf8; --accent2:#34d399; --radius:14px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);}
header{padding:20px;text-align:center;}
h1{margin:0;font-size:24px;}
.container{max-width:700px;margin:auto;padding:20px;}
.card{background:var(--card);padding:16px;border-radius:var(--radius);
      box-shadow:0 4px 12px rgba(0,0,0,.1);margin:16px 0;}
button{padding:6px 12px;border:none;border-radius:8px;background:var(--accent);color:#fff;cursor:pointer;margin:4px 4px 0 0;}
ul{padding-left:20px;}
footer{text-align:center;color:var(--muted);font-size:13px;margin:20px;}
#health{position:fixed;top:8px;right:8px;font-size:12px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid #cde4e7;color:#083344;box-shadow:0 2px 8px rgba(0,0,0,.06);}
#confetti{position:fixed;inset:0;pointer-events:none}
</style>
<body>
<div id="health">ğŸ”´ JS æœªåŠ è½½</div>
<div class="container">
  <div class="card">
    <h3>âœ… ä»Šæ—¥ä¸‰ä»¶å°äº‹</h3>
    <ul id="tasks"></ul>
    <button id="btnAdd">æ·»åŠ ä»»åŠ¡</button>
    <button id="btnClear">æ¸…ç©ºä»»åŠ¡</button>
  </div>

  <div class="card">
    <h3>ğŸŒˆ æƒ…ç»ªå¤©æ°”</h3>
    <input type="range" min="0" max="100" value="50" id="mood">
    <span id="moodVal">ğŸ™‚</span>
    <button id="btnMoodReset">é‡ç½®å¿ƒæƒ…</button>
  </div>

  <div class="card">
    <h3>ğŸ’Œ æ„Ÿæ©ä¸‰ä»¶äº‹</h3>
    <textarea id="gratitude" style="width:100%;height:80px;"></textarea><br>
    <button id="btnGReset">æ¸…ç©ºæ„Ÿæ©</button>
  </div>

  <div class="card">
    <h3>ğŸ“¤ å¯¼å‡ºè®°å½•</h3>
    <button id="btnExport">å¯¼å‡º TXT</button>
  </div>

</div>

<footer>
  <p id="stats">åŠ è½½ä¸­...</p>
</footer>

<canvas id="confetti"></canvas>

<script>
(function(){
  // å¥åº·æŒ‡ç¤º
  const health = document.getElementById('health');
  const ok = (msg)=>{ health.textContent = 'ğŸŸ¢ ' + msg; };
  const fail = (msg)=>{ health.textContent = 'ğŸ”´ ' + msg; };

  try {
    console.log('[TW] JS loaded');
    ok('JS OK');

    // å…ƒç´ 
    const elTasks = document.getElementById('tasks');
    const elMood = document.getElementById('mood');
    const elMoodVal = document.getElementById('moodVal');
    const elGrat = document.getElementById('gratitude');
    const elStats = document.getElementById('stats');

    // ç»‘å®šæŒ‰é’® (é¿å… inline onclick è´´é”™)
    document.getElementById('btnAdd').addEventListener('click', addTask);
    document.getElementById('btnClear').addEventListener('click', clearTasks);
    document.getElementById('btnMoodReset').addEventListener('click', resetMood);
    document.getElementById('btnGReset').addEventListener('click', resetGratitude);
    document.getElementById('btnExport').addEventListener('click', exportData);

    // äº‹ä»¶
    elMood.addEventListener('input', function(){ updateMoodEmoji(this.value); saveData(); });
    elGrat.addEventListener('input', saveData);

    /* ---------- æœ¬åœ°å­˜å‚¨ ---------- */
    function saveData(){
      const data = {
        tasks: Array.from(elTasks.querySelectorAll('li')).map(li=>li.textContent),
        mood: elMood.value,
        gratitude: elGrat.value,
        last: new Date().toISOString().slice(0,10),
        days: (JSON.parse(localStorage.getItem('tinywins'))?.days || 0)
      };
      const old = JSON.parse(localStorage.getItem('tinywins')||'{}');
      if(old.last !== data.last){ data.days += 1; }
      localStorage.setItem('tinywins', JSON.stringify(data));
      updateStats();
      console.log('[TW] saved', data);
    }

    function loadData(){
      const data = JSON.parse(localStorage.getItem('tinywins')||'{}');
      console.log('[TW] loaded', data);
      if(data.tasks){
        data.tasks.forEach(t=>{
          const li=document.createElement('li'); li.textContent=t; elTasks.appendChild(li);
        });
      }
      if(data.mood){ elMood.value=data.mood; updateMoodEmoji(data.mood); }
      if(data.gratitude){ elGrat.value=data.gratitude; }
      updateStats();
    }

    function updateStats(){
      const data = JSON.parse(localStorage.getItem('tinywins')||'{}');
      if(data.days){
        elStats.textContent = `ğŸ“Š å·²ç´¯è®¡è®°å½• ${data.days} å¤© Â· æœ€è¿‘ä¸€æ¬¡ ${data.last||"-"}`;
      }else{
        elStats.textContent = "ğŸ“Š è¿˜æ²¡æœ‰å¼€å§‹è®°å½•ï¼ŒåŠ æ²¹ï¼";
      }
    }

    /* ---------- ä»»åŠ¡ ---------- */
    function addTask(){
      const text = prompt("è¾“å…¥ä¸€ä¸ªå°ä»»åŠ¡ï¼š");
      if(text){
        const li=document.createElement('li'); li.textContent=text; elTasks.appendChild(li);
        saveData(); checkTasks();
      }
    }
    function clearTasks(){ elTasks.innerHTML = ""; saveData(); }
    function checkTasks(){ if(elTasks.querySelectorAll('li').length>=3){ launchConfetti(); } }

    /* ---------- å¿ƒæƒ… ---------- */
    function resetMood(){ elMood.value = 50; updateMoodEmoji(50); saveData(); }
    function updateMoodEmoji(v){
      let e="ğŸ™‚"; if(v>80) e="ğŸ˜"; else if(v<30) e="ğŸŒ§ï¸";
      elMoodVal.textContent=e;
    }

    /* ---------- æ„Ÿæ© ---------- */
    function resetGratitude(){ elGrat.value=""; saveData(); }

    /* ---------- å¯¼å‡º ---------- */
    function exportData(){
      const data = JSON.parse(localStorage.getItem('tinywins')||'{}');
      let txt = `ğŸŒ¤ï¸ å¤±ä¸šä½†åšå¼º Â· Tiny Wins\næ—¥æœŸ: ${new Date().toLocaleDateString()}\n\n`;
      txt += "âœ… ä»Šæ—¥å°äº‹:\n" + (data.tasks||[]).map((t,i)=>`${i+1}. ${t}`).join("\n") + "\n\n";
      txt += `ğŸŒˆ å¿ƒæƒ…æŒ‡æ•°: ${data.mood||"-"}\n\n`;
      txt += `ğŸ’Œ æ„Ÿæ©: \n${data.gratitude||"-"}\n\n`;
      txt += `ğŸ“Š å·²ç´¯è®¡è®°å½• ${data.days||0} å¤©\n`;
      const blob = new Blob([txt], {type:"text/plain"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "tinywins.txt";
      a.click();
      console.log('[TW] exported');
    }

    /* ---------- å½©å¸¦ç‰¹æ•ˆ ---------- */
    const confetti=document.getElementById("confetti"),ctx=confetti.getContext("2d");
    function resize(){ confetti.width=innerWidth; confetti.height=innerHeight; }
    addEventListener('resize', resize); resize();

    function launchConfetti(){
      let pieces=[];
      for(let i=0;i<150;i++){
        pieces.push({
          x:Math.random()*confetti.width,
          y:-Math.random()*confetti.height,
          w:10,h:10,
          color:`hsl(${Math.random()*360},100%,50%)`,
          speed:Math.random()*3+2
        });
      }
      (function tick(){
        ctx.clearRect(0,0,confetti.width,confetti.height);
        pieces.forEach(p=>{ p.y+=p.speed; ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.w,p.h); });
        pieces=pieces.filter(p=>p.y<confetti.height);
        if(pieces.length) requestAnimationFrame(tick);
      })();
    }

    // åˆå§‹åŒ–
    loadData();
    ok('JS OK');
  } catch (e){
    console.error('[TW] error', e);
    fail('JS æŠ¥é”™ï¼Œæ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹');
  }
})();
</script>
</body>
</html>
