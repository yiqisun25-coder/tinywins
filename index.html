<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>å¤±ä¸šä½†åšå¼º Â· Tiny Wins</title>
<style>
  :root{
    --bg:#0e0f12;--card:#16181d;--text:#e6e6ea;--muted:#a8acb9;
    --accent:#7dd3fc;--accent2:#c4b5fd;--good:#86efac;--warn:#fca5a5;
    --line:#262a33;--shadow:0 6px 20px rgba(0,0,0,.25);--radius:14px;
  }
  body{margin:0;background:radial-gradient(1200px 1200px at 80% -10%, #1a1f28 0%, var(--bg) 50%);
       color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
       letter-spacing:.1px;}
  *{box-sizing:border-box}
  header{padding:28px 20px 10px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .title{font-size:20px;font-weight:700;display:flex;align-items:center;gap:10px}
  .title .chip{font-size:12px;color:#0b1220;background:linear-gradient(135deg,var(--accent),var(--accent2));
               padding:4px 10px;border-radius:999px}
  .sub{color:var(--muted);font-size:13px}
  .container{max-width:1100px;margin:0 auto;padding:10px 20px 80px;display:grid;
             grid-template-columns:repeat(12,1fr);gap:16px}
  .card{grid-column:span 12;background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
        box-shadow:var(--shadow);padding:16px}
  @media(min-width:860px){
    .card.span6{grid-column:span 6}
    .card.span4{grid-column:span 4}
  }
  .card h3{margin:0 0 10px;font-size:16px}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);
                     background:#0f1116;color:var(--text);outline:none}
  textarea{width:100%;min-height:86px;padding:10px 12px;border-radius:10px;border:1px solid var(--line);
           background:#0f1116;color:var(--text);resize:vertical;outline:none}
  .btn{appearance:none;border:1px solid var(--line);background:#10131a;color:var(--text);padding:10px 12px;
       border-radius:12px;cursor:pointer;transition:.2s;user-select:none}
  .btn:hover{transform:translateY(-1px);border-color:#3a3f4d}
  .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b1220;border:none}
  .btn.ghost{background:transparent}
  .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:8px 10px;border-radius:999px}
  .checkline{display:flex;align-items:center;gap:10px}
  .checkline input[type="checkbox"]{width:18px;height:18px}
  .muted{color:var(--muted);font-size:12px}
  .bar{height:10px;background:#0f1116;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .split{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  .badge{font-size:12px;color:#0b1220;background:linear-gradient(135deg,#34d399,#22d3ee);padding:3px 8px;border-radius:999px}
  .stat{font-size:28px;font-weight:800}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .habit{display:flex;justify-content:space-between;align-items:center;border:1px dashed #2a3040;border-radius:12px;
         padding:10px}
  .habit .streak{font-size:12px;color:var(--muted)}
  .right{margin-left:auto}
  footer{position:fixed;bottom:12px;left:0;right:0;display:flex;justify-content:center;pointer-events:none}
  footer .dock{pointer-events:auto;background:rgba(17,19,26,.7);backdrop-filter:blur(10px);
               border:1px solid var(--line);border-radius:999px;padding:8px;display:flex;gap:8px}
  canvas#confetti{position:fixed;inset:0;pointer-events:none}
  .mini{font-size:12px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<header>
  <div class="title">ğŸŒ¤ï¸ å¤±ä¸šä½†åšå¼º Â· Tiny Wins <span class="chip">æœ¬åœ°ä¿å­˜</span></div>
  <div class="sub" id="today"></div>
</header>

<div class="container">
  <!-- ä»Šæ—¥ä¸‰ä»¶å°äº‹ -->
  <section class="card span6" id="tasks">
    <h3>âœ… ä»Šæ—¥ä¸‰ä»¶å°äº‹ <span class="badge" id="taskBadge">0/3</span></h3>
    <div class="bar" aria-label="progress"><span id="taskProgress" style="width:0%"></span></div>
    <div style="height:8px"></div>
    <div id="taskList"></div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="addTask">â• å†æ¥ä¸€ä»¶</button>
      <button class="btn ghost" id="resetTasks">ğŸ§¹ æ¸…ç©ºä»Šå¤©</button>
      <span class="muted">å®Œæˆ 3/3 ä¼šæ‰å½©å¸¦ï½</span>
    </div>
  </section>

  <!-- æƒ…ç»ªå¤©æ°” -->
  <section class="card span6" id="mood">
    <h3>ğŸŒˆ æƒ…ç»ªå¤©æ°”ï¼ˆ0~100ï¼‰ <span class="badge" id="moodEmoji">ğŸ™‚</span></h3>
    <div class="split">
      <input type="range" min="0" max="100" step="1" id="moodRange" />
      <button class="btn" id="saveMood">ğŸ“Œ è®°å½•</button>
    </div>
    <div class="row" style="justify-content:space-between;margin-top:8px">
      <span class="muted">æœ€è¿‘ä¸¤å‘¨æ›²çº¿</span>
      <span class="muted mini">å¹³å‡ <span id="moodAvg">-</span></span>
    </div>
    <canvas id="spark" height="60" style="width:100%;border-radius:10px;border:1px solid var(--line);background:#0f1116"></canvas>
  </section>

  <!-- æ„Ÿæ©ä¸‰ä»¶äº‹ -->
  <section class="card span6" id="gratitude">
    <h3>ğŸ’Œ æ„Ÿæ©ä¸‰ä»¶äº‹</h3>
    <textarea id="gratitudeText" placeholder="ä¾‹ï¼š1ï¼‰ä»Šå¤©æŒ‰æ—¶åƒé¥­  2ï¼‰æœ‹å‹çš„å…³å¿ƒ  3ï¼‰è‡ªå·±æ²¡æœ‰æ”¾å¼ƒ"></textarea>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="saveGratitude">ä¿å­˜</button>
      <button class="btn ghost" id="promptG">æ¢ä¸€ä¸ªæç¤º</button>
      <span class="muted">å†™ä¸‹å¾®å°çš„å…‰ï¼Œä¼šè¢«è®°ä½ã€‚</span>
    </div>
    <div class="muted mini" id="gHint" style="margin-top:6px"></div>
  </section>

  <!-- å¾®ä¹ æƒ¯æ‰“å¡ -->
  <section class="card span6" id="habits">
    <h3>ğŸ¥¤ å¾®ä¹ æƒ¯æ‰“å¡</h3>
    <div class="grid" id="habitGrid"></div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="addHabit">â• è‡ªå®šä¹‰ä¹ æƒ¯</button>
      <button class="btn ghost" id="resetHabitsToday">ğŸ”„ é‡ç½®ä»Šæ—¥</button>
      <span class="muted">è¿ç»­æ‰“å¡è‡ªåŠ¨è®¡è¿ç»­å¤©æ•°ã€‚</span>
    </div>
  </section>

  <!-- é¢„ç®—å°è®¡ç®—å™¨ -->
  <section class="card span4" id="budget">
    <h3>ğŸ’¸ æ—¥èŠ±å»ºè®®</h3>
    <div class="row">
      <input type="text" id="cash" placeholder="å½“å‰ä½™é¢ï¼ˆå…ƒï¼‰">
      <input type="text" id="days" placeholder="æƒ³æ’‘å¤©æ•°ï¼ˆå¤©ï¼‰">
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="calc">è®¡ç®—</button>
      <div class="right stat mono" id="perday">--/å¤©</div>
    </div>
    <div class="muted mini" style="margin-top:6px">Tipï¼šå…ˆä¿åº•ï¼ˆæˆ¿ç§Ÿ/é¤é¥®/äº¤é€šï¼‰å†ç•™å¼¹æ€§é¢„ç®—ã€‚</div>
  </section>

  <!-- éšæœºæŒ‘æˆ˜ & æ‰“æ°” -->
  <section class="card span4" id="pep">
    <h3>âš¡ éšæœºæŒ‘æˆ˜ / æ‰“æ°”</h3>
    <div class="row" style="margin-bottom:8px">
      <button class="btn primary" id="randomChallenge">ğŸ² æ¥ä¸ªå°æŒ‘æˆ˜</button>
      <button class="btn" id="randomQuote">ğŸ—£ï¸ æ¥å¥ç‹ è¯</button>
      <button class="btn ghost" id="bless">ğŸª„ Kæ€»ä¿ä½‘</button>
    </div>
    <div id="displayZone" class="muted" style="min-height:48px"></div>
  </section>

  <!-- å¯¼å‡ºä»Šæ—¥ -->
  <section class="card span4" id="exporter">
    <h3>ğŸ“¤ å¯¼å‡ºä»Šå¤©</h3>
    <div class="row">
      <button class="btn" id="exportTxt">å¯¼å‡º TXT</button>
      <button class="btn ghost" id="darkToggle">ğŸŒ™ å¤œé—´/æ—¥é—´</button>
    </div>
    <div class="muted mini" style="margin-top:6px">å¯¼å‡ºåŒ…å«ï¼šä»»åŠ¡å®Œæˆæƒ…å†µã€æƒ…ç»ªæŒ‡æ•°ã€æ„Ÿæ©æ¡ç›®ã€ä¹ æƒ¯æ‰“å¡ã€‚</div>
  </section>
</div>

<footer>
  <div class="dock">
    <button class="btn mini" id="seed">ä¸€é”®å¡«å……ç¤ºä¾‹</button>
    <span class="muted mini">Keep showing up. Tiny wins â†’ huge momentum.</span>
  </div>
</footer>

<script>
(() => {
  const $ = s=>document.querySelector(s);
  const $$ = s=>document.querySelectorAll(s);
  const store = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
  const load = (k,d)=>{ try{ const v=JSON.parse(localStorage.getItem(k)); return v??d }catch{ return d }};
  const todayStr = ()=> new Date().toISOString().slice(0,10);
  const ymd = todayStr();
  $("#today").textContent = new Date().toLocaleString([], {hour12:false, year:'numeric', month:'long', day:'numeric', weekday:'short', hour:'2-digit', minute:'2-digit'});

  /* --------- Confetti --------- */
  const cf = $("#confetti"), ctx = cf.getContext('2d');
  let W=cf.width=innerWidth, H=cf.height=innerHeight;
  addEventListener('resize',()=>{W=cf.width=innerWidth;H=cf.height=innerHeight});
  function boom() {
    const n=160, P=[];
    for(let i=0;i<n;i++){
      P.push({
        x:W/2, y:H/3, r:2+Math.random()*3,
        vx:(Math.random()-0.5)*6, vy:(Math.random()*-6-2),
        g:0.15+Math.random()*0.2, a:1, col=`hsl(${Math.random()*360},90%,60%)`
      });
    }
    let t=0;
    (function anim(){
      t++;
      ctx.clearRect(0,0,W,H);
      P.forEach(p=>{
        p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.a-=0.008;
        ctx.globalAlpha=Math.max(p.a,0);
        ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=p.col; ctx.fill();
      });
      ctx.globalAlpha=1;
      if(t<220) requestAnimationFrame(anim); else ctx.clearRect(0,0,W,H);
    })();
  }

  /* --------- Tasks --------- */
  const TASK_KEY = "xiaoP.tasks."+ymd;
  const defaultTasks = ["å–æ°´500ml","æŠ•é€’2ä»½ç®€å†/æ›´æ–°ç®€å†1å¤„","å¿«èµ°æˆ–æ‹‰ä¼¸10åˆ†é’Ÿ"];
  let tasks = load(TASK_KEY, defaultTasks.map(t=>({text:t,done:false})));
  const taskList = $("#taskList");
  function renderTasks(){
    taskList.innerHTML="";
    tasks.forEach((t,i)=>{
      const row = document.createElement('div'); row.className='checkline';
      row.innerHTML = `
        <input type="checkbox" ${t.done?'checked':''} data-i="${i}"/>
        <input type="text" value="${t.text.replace(/"/g,'&quot;')}" data-i="${i}" />
        <button class="btn mini ghost" data-del="${i}">åˆ </button>
      `;
      taskList.appendChild(row);
    });
    const done = tasks.filter(x=>x.done).length;
    $("#taskBadge").textContent = `${done}/${tasks.length}`;
    $("#taskProgress").style.width = `${(done/(tasks.length||1))*100}%`;
    if(done>=3){ boom() }
    store(TASK_KEY,tasks);
  }
  taskList.addEventListener('change',e=>{
    const i = +e.target.dataset.i;
    if(e.target.type==='checkbox'){ tasks[i].done = e.target.checked; renderTasks(); }
  });
  taskList.addEventListener('input',e=>{
    const i = +e.target.dataset.i;
    if(e.target.type==='text'){ tasks[i].text = e.target.value; store(TASK_KEY,tasks); }
  });
  taskList.addEventListener('click',e=>{
    const d = e.target.dataset.del;
    if(d!=null){ tasks.splice(+d,1); renderTasks(); }
  });
  $("#addTask").onclick = ()=>{ tasks.push({text:"",done:false}); renderTasks(); };
  $("#resetTasks").onclick = ()=>{ if(confirm("åªæ¸…ç©ºä»Šå¤©çš„ä¸‰ä»¶å°äº‹ï¼Ÿ")){ tasks = []; renderTasks(); } };
  renderTasks();

  /* --------- Mood --------- */
  const MOOD_LOG_KEY = "xiaoP.moodLogs";
  const moodRange=$("#moodRange"), moodEmoji=$("#moodEmoji"), saveMood=$("#saveMood");
  const emoji = v => v>=80?"ğŸ˜":v>=65?"ğŸ™‚":v>=45?"ğŸ˜":v>=25?"ğŸ˜•":"ğŸŒ§ï¸";
  function moodToAvg(arr){ if(!arr.length) return 0; return Math.round(arr.reduce((a,b)=>a+b.v,0)/arr.length); }
  function setEmoji(){ moodEmoji.textContent = emoji(+moodRange.value); }
  setEmoji();
  moodRange.oninput=setEmoji;
  saveMood.onclick=()=>{
    const logs = load(MOOD_LOG_KEY,[]);
    const idx = logs.findIndex(d=>d.d===ymd);
    const entry = {d:ymd,v:+moodRange.value};
    if(idx>-1) logs[idx]=entry; else logs.push(entry);
    store(MOOD_LOG_KEY,logs);
    drawSpark();
  };
  function drawSpark(){
    const logs = load(MOOD_LOG_KEY,[]).slice(-14);
    const c=$("#spark"), g=c.getContext('2d');
    c.width = c.clientWidth; c.height = c.height; // keep 60
    g.clearRect(0,0,c.width,c.height);
    if(!logs.length){ $("#moodAvg").textContent='-'; return }
    $("#moodAvg").textContent = moodToAvg(logs);
    const pad=8, w=c.width-2*pad, h=c.height-2*pad;
    const ys = logs.map(x=>x.v);
    const min=0, max=100, step=w/Math.max(1,(logs.length-1));
    g.strokeStyle = "#293041"; g.lineWidth=1; g.beginPath();
    for(let i=0;i<=5;i++){ let y=pad+i*(h/5); g.moveTo(pad,y); g.lineTo(pad+w,y); } g.stroke();
    g.lineWidth=2; g.strokeStyle = "#7dd3fc"; g.beginPath();
    logs.forEach((p,i)=>{
      const x=pad+i*step;
      const y=pad + (1-(p.v-min)/(max-min))*h;
      if(i===0) g.moveTo(x,y); else g.lineTo(x,y);
      // point
      g.fillStyle="#c4b5fd"; g.beginPath(); g.arc(x,y,2.5,0,Math.PI*2); g.fill();
    });
    // last value badge
    const last=logs[logs.length-1];
    const lx=pad+(logs.length-1)*step, ly=pad+(1-(last.v-min)/(max-min))*h;
    g.fillStyle="#86efac"; g.fillRect(lx-14,ly-18,28,16);
    g.fillStyle="#0b1220"; g.font="12px system-ui"; g.textAlign="center"; g.textBaseline="middle";
    g.fillText(last.v, lx, ly-10);
  }
  drawSpark();

  /* --------- Gratitude --------- */
  const G_KEY="xiaoP.gratitude."+ymd, gText=$("#gratitudeText");
  const hints=[
    "ä»Šå¤©è®©æˆ‘æ¾å£æ°”çš„ä¸€ç¬é—´æ˜¯ï¼Ÿ",
    "è°çš„å“ªå¥è¯è®©æˆ‘è§‰å¾—è¢«çœ‹è§ï¼Ÿ",
    "æˆ‘åšå¯¹äº†ä¸€ä»¶å°äº‹æ˜¯ä»€ä¹ˆï¼Ÿ",
    "ä»Šå¤©çš„èº«ä½“ä¿¡å·ï¼ˆç¡çœ /é¥®é£Ÿ/è¿åŠ¨ï¼‰é‡Œï¼Œå“ªä¸ªå€¼å¾—è¡¨æ‰¬ï¼Ÿ"
  ];
  const hint=()=>hints[Math.floor(Math.random()*hints.length)];
  $("#gHint").textContent = "æç¤ºï¼š"+hint();
  gText.value = load(G_KEY,"");
  $("#saveGratitude").onclick = ()=>{ store(G_KEY,gText.value.trim()); boom(); };
  $("#promptG").onclick = ()=>{ $("#gHint").textContent = "æç¤ºï¼š"+hint(); };

  /* --------- Habits --------- */
  const H_KEY="xiaoP.habits";
  let habits = load(H_KEY, [
    {name:"å–æ°´ 6 æ¯", streak:0, last:'' , today:false},
    {name:"æŠ•é€’ â‰¥2 ä»½ç®€å†", streak:0, last:'' , today:false},
    {name:"è¿åŠ¨ 10 åˆ†é’Ÿ", streak:0, last:'' , today:false},
    {name:"é˜…è¯» 20 é¡µ", streak:0, last:'' , today:false},
    {name:"è‹±è¯­ 15 åˆ†é’Ÿ", streak:0, last:'' , today:false},
  ]);
  const grid=$("#habitGrid");
  function diffDays(a,b){ return Math.round((new Date(a)-new Date(b))/86400000) }
  function renderHabits(){
    grid.innerHTML="";
    habits.forEach((h,i)=>{
      const el=document.createElement('div'); el.className='habit';
      el.innerHTML=`
        <span>${h.today?'âœ…':'â¬œ'} ${h.name}<br><span class="streak">è¿å‡»ï¼š${h.streak} å¤©</span></span>
        <div class="row">
          <button class="btn mini" data-ok="${i}">${h.today?'å·²æ‰“å¡':'æ‰“å¡'}</button>
          <button class="btn mini ghost" data-del="${i}">åˆ </button>
        </div>
      `;
      grid.appendChild(el);
    });
    store(H_KEY,habits);
  }
  grid.addEventListener('click',e=>{
    const iOk=e.target.dataset.ok, iDel=e.target.dataset.del;
    if(iOk!=null){
      const h=habits[+iOk];
      if(h.today){ alert("ä»Šå¤©å·²æ‰“å¡"); return; }
      if(h.last){
        const d=diffDays(ymd, h.last);
        if(d===1) h.streak+=1;
        else if(d===0) {/*nop*/}
        else h.streak=1;
      }else h.streak=1;
      h.last=ymd; h.today=true; boom();
      renderHabits();
    }
    if(iDel!=null){ habits.splice(+iDel,1); renderHabits(); }
  });
  $("#addHabit").onclick=()=>{
    const n=prompt("è¾“å…¥ä¹ æƒ¯åç§°ï¼ˆä¾‹å¦‚ï¼šå†¥æƒ³ 5 åˆ†é’Ÿï¼‰");
    if(n){ habits.push({name:n,streak:0,last:'',today:false}); renderHabits(); }
  };
  $("#resetHabitsToday").onclick=()=>{
    habits = habits.map(h=>({ ...h, today:false }));
    renderHabits();
  };
  // è·¨å¤©è‡ªåŠ¨æ¸… today
  habits = habits.map(h => ({...h, today: h.last===ymd ? h.today : false }));
  renderHabits();

  /* --------- Budget --------- */
  $("#calc").onclick=()=>{
    const cash=parseFloat($("#cash").value.replace(/[^\d.]/g,'')),
          days=parseFloat($("#days").value.replace(/[^\d.]/g,''));
    if(!cash || !days || days<=0){ $("#perday").textContent="--/å¤©"; return }
    const per=cash/days;
    $("#perday").textContent = (Math.floor(per*100)/100).toFixed(2)+"/å¤©";
  };

  /* --------- Randoms & Bless --------- */
  const challenges=[
    "ä»Šå¤© 20 åˆ†é’Ÿä¿¡æ¯å‡è´Ÿï¼šå±è”½ 3 ä¸ªæ— æ•ˆä¿¡æ¯æºã€‚",
    "æŠŠç®€å†ä¸Š 1 ä¸ª bullet å‡çº§ä¸º STAR å™è¿°ï¼ˆ30 åˆ†é’Ÿå°é¡¶ï¼‰ã€‚",
    "ç»™è‡ªå·±åšä¸€é¡¿é«˜è›‹ç™½æ™šé¤ã€‚",
    "æŠŠæˆ¿é—´ä¸€ä¸ªè§’è½æ”¶çº³åˆ° 80 åˆ†ï¼ˆè®¡æ—¶ 15 åˆ†é’Ÿï¼‰ã€‚",
    "è”ç³» 1 ä½è€åŒå­¦/å‰åŒäº‹ï¼ŒèŠè¿‘å†µä¸æœºä¼šï¼ˆä¸æ±‚æŠ•ç®€å†ï¼Œåªå»ºç«‹å¼±å…³ç³»ï¼‰ã€‚",
    "æ­¥è¡Œ 3000 æ­¥å¬æ’­å®¢ã€‚"
  ];
  const quotes=[
    "ä½ ä¸æ˜¯å¤±è´¥ï¼Œä½ æ˜¯åœ¨åŠ è½½è¿›åº¦æ¡ã€‚â€” Gen Z ç‰ˆè‡ªå‹‰",
    "ä»Šå¤©åšå¯¹ 1 ä»¶å°äº‹ > æ˜å¤©æƒ³å¯¹ 100 ä»¶ã€‚",
    "åˆ«å†…è€—ï¼Œå»åšäº‹ã€‚æƒ…ç»ªå¬æŒ‡æŒ¥ï¼Œè¡ŒåŠ¨ç»™ç­”æ¡ˆã€‚",
    "ä¸–ç•Œå¾ˆåµï¼Œä½ è¦å¾ˆç¨³ã€‚â€” K æ€»",
    "å°±ä¸šå¸‚åœºå¾ˆå·ï¼Œä½†ä½ æœ‰è‡ªå·±çš„è·¯æ•°ä¸èŠ‚å¥ã€‚"
  ];
  $("#randomChallenge").onclick=()=>{ $("#displayZone").textContent="âš¡ "+challenges[Math.floor(Math.random()*challenges.length)] };
  $("#randomQuote").onclick=()=>{ $("#displayZone").textContent="ğŸ—£ï¸ "+quotes[Math.floor(Math.random()*quotes.length)] };
  $("#bless").onclick=()=>{ boom(); tone(); };

  // ç®€æ˜“éŸ³è‰²
  function tone(){
    const actx=new (window.AudioContext||window.webkitAudioContext)();
    const o=actx.createOscillator(), g=actx.createGain();
    o.type="triangle"; o.frequency.value=660;
    o.connect(g); g.connect(actx.destination);
    g.gain.setValueAtTime(0.0001, actx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2, actx.currentTime+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.25);
    o.start(); o.stop(actx.currentTime+0.26);
  }

  /* --------- Export --------- */
  $("#exportTxt").onclick=()=>{
    const logs = load(MOOD_LOG_KEY,[]);
    const mood = logs.find(x=>x.d===ymd)?.v ?? "-";
    const done = tasks.filter(t=>t.done).length;
    const lines = [
      `ã€æ—¥æœŸã€‘${ymd}`,
      `ã€æƒ…ç»ªã€‘${mood}/100`,
      `ã€ä¸‰ä»¶å°äº‹ã€‘å®Œæˆ ${done}/${tasks.length}`,
      ...tasks.map((t,i)=>`  - [${t.done?'x':' '}] ${i+1}. ${t.text}`),
      `ã€æ„Ÿæ©ã€‘`,
      (gText.value||"(ç©º)").split("\n").map(s=>`  - ${s.trim()}`).join("\n"),
      `ã€ä¹ æƒ¯æ‰“å¡ã€‘`,
      ...habits.map(h=>`  - ${h.name} | ä»Šæ—¥ï¼š${h.today?'âœ…':'â¬œ'} | è¿å‡»ï¼š${h.streak} å¤©`)
    ].flat().join("\n");
    const file = new Blob([lines],{type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(file);
    const a=document.createElement('a'); a.href=url; a.download=`TinyWins_${ymd}.txt`;
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  };

  /* --------- Dark/Light --------- */
  let light=false;
  $("#darkToggle").onclick=()=>{
    light=!light;
    if(light){
      document.documentElement.style.setProperty('--bg','#f6f7fb');
      document.documentElement.style.setProperty('--card','#ffffff');
      document.documentElement.style.setProperty('--text','#0e1220');
      document.documentElement.style.setProperty('--muted','#5f667a');
      document.documentElement.style.setProperty('--line','#e7e9f0');
    }else{
      document.documentElement.style.setProperty('--bg','#0e0f12');
      document.documentElement.style.setProperty('--card','#16181d');
      document.documentElement.style.setProperty('--text','#e6e6ea');
      document.documentElement.style.setProperty('--muted','#a8acb9');
      document.documentElement.style.setProperty('--line','#262a33');
    }
  };

  /* --------- Seed Demo --------- */
  $("#seed").onclick=()=>{
    tasks = [
      {text:"æ›´æ–°ç®€å†é¡¹ç›®äº®ç‚¹ 1 æ¡",done:true},
      {text:"å®Œæˆ 15 åˆ†é’Ÿæ‹‰ä¼¸",done:false},
      {text:"æŠ•é€’ 2 ä»½ JD",done:false},
    ];
    renderTasks();
    $("#gratitudeText").value="1ï¼‰è°¢è°¢è‡ªå·±è¿˜åœ¨åŠªåŠ›\n2ï¼‰ä»Šå¤©å–åˆ°äº†å¥½å–çš„å’–å•¡\n3ï¼‰æœ‹å‹çš„è½¬å‘ä¸æ‰“æ°”";
    store(G_KEY,$("#gratitudeText").value);
    $("#moodRange").value=68; setEmoji(); saveMood.click();
    $("#displayZone").textContent="âš¡ ç»ƒä¹  10 åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»å¹¶å½•éŸ³å›æ”¾ã€‚";
  };
})();
</script>
</body>
</html>
